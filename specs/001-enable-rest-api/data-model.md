# Data Model: REST Backend Service Transformation

## Overview

The REST API exposes a stateless calculation workflow that accepts compound-interest input data,
validates business rules, computes resulting balances deterministically, and returns structured
responses with supporting metadata for auditing and front-end consumption.

## Entities

### CalculationRequest

| Field | Type | Description | Validation Rules |
|-------|------|-------------|------------------|
| `principal` | decimal | Initial investment or balance amount | Required; MUST be ≥ 0 and ≤ 10,000,000 |
| `annualRatePercent` | decimal | Annual interest rate expressed as percentage | Required; MUST be between 0 and 100 inclusive |
| `compoundingCadence` | string | Frequency of compounding (e.g., `Annual`, `Monthly`) | Required; limited to supported enum values |
| `durationYears` | int | Number of years to apply compounding | Required; MUST be ≥ 0 and < 100 |
| `clientReference` | string | Optional client-supplied identifier for traceability | Optional; trim whitespace, max 64 chars |
| `requestedAt` | DateTimeOffset | Timestamp when request was generated by client | Optional; default to server time if missing |

### CalculationResult

| Field | Type | Description | Notes |
|-------|------|-------------|-------|
| `startingPrincipal` | decimal | Echo of `principal` supplied in request | Read-only |
| `annualRatePercent` | decimal | Echo of interest rate | Read-only |
| `compoundingCadence` | string | Echo of cadence | Read-only |
| `durationYears` | int | Echo of duration | Read-only |
| `endingBalance` | decimal | Calculated ending balance | Rounded using banker's rounding to 2 decimals |
| `currencyDisplay` | string | Localized currency string (e.g., `$12,345.67`) | Derived using en-US formatting to match legacy |
| `calculationVersion` | string | Semantic identifier for calculation algorithm | Start with `v1.0` to match legacy output |
| `traceId` | string | Correlation token generated per request | Mirrors Application Insights operation ID |
| `responseId` | Guid | Unique identifier for response payload | New GUID per response |

### ControllerLogEntry (telemetry payload)

| Field | Type | Description |
|-------|------|-------------|
| `timestamp` | DateTimeOffset | Time of log emission |
| `traceId` | string | Correlates request/response/log entries |
| `route` | string | Controller route template (e.g., `/api/v1/calculations`) |
| `httpMethod` | string | HTTP verb |
| `statusCode` | int | Resulting status code |
| `validationOutcome` | string | `Success`, `ClientError`, `ServerError` |
| `reason` | string | Plain-language explanation when `validationOutcome` ≠ `Success` |
| `clientReference` | string | Optional echo from request to aid client debugging |

## Relationships

- `CalculationRequest` maps one-to-one to `CalculationResult` for each request.
- `ControllerLogEntry` references the same `traceId` used in `CalculationResult`.
- Mapping between DTOs occurs via dedicated mapper layer to maintain immutability and deterministic behavior.

## State & Workflow

1. API receives JSON payload; deserializes into `CalculationRequest`.
2. Validation pipeline ensures business rules (non-negative values, supported cadence, duration limits).
3. Domain service converts percentage to decimal, applies compounding based on cadence, and rounds using deterministic rules.
4. Response mapper constructs `CalculationResult`, including currency display and metadata.
5. Controller writes success or failure `ControllerLogEntry` with plain-language reason.

## Enumerations

- `CompoundingCadence`:
  - `Annual`
  - `SemiAnnual`
  - `Quarterly`
  - `Monthly`
  - `Daily` (optional, ensure parity testing before enabling)

## Invariants

- Calculations MUST use decimal arithmetic with `MidpointRounding.ToEven`.
- Conversion helper functions remain pure (no side effects).
- Currency display MUST remain consistent with legacy Function output (en-US locale).
- Trace identifiers MUST propagate from incoming request to telemetry sinks.
